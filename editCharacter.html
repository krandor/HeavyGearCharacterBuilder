<!DOCTYPE>
<html>
<head>
    <title id="title" data-bind="text: text">Heavy Gear Character Builder</title>
    <meta name="author" content="Jesse Hutchison" />
    <meta name="coauthor" content="Sean Carnes">
    <meta name="keywords" content="heavy, gear, character, builder">
    <meta name="description" content="A web tool using the 2nd edition rule book from 1997 to generate a character">
    <link rel="stylesheet" type="text/css" href="styles/master.css">
    <link href='http://fonts.googleapis.com/css?family=Oswald:700' rel='stylesheet' type='text/css'>
    <link rel="icon" type="image/png" href="images/favicon.png" />

    <!-- libraries -->
    <script src="scripts/jquery.min.js"></script>
    <script src="scripts/jquery-ui-1.11.4.min.js"></script>
    <script src="scripts/jquery.autocomplete.min.js"></script>
    <script src="scripts/jquery.tiptip.custom.js"></script>    
    <script src='scripts/knockout-3.1.0.js'></script>
    <script src="scripts/tooltip.js"></script>
    <!-- globals -->
    <script src="scripts/global/prototypeString.js"></script>
    <script src="scripts/global/prototypeArray.js"></script>
    <script src="scripts/global/config.js"></script>
    <script src="scripts/global/getQueryParams.js"></script>
    <script src="scripts/global/uuid.js"></script>
    <script src="scripts/global/localStorage.js"></script>
    <script src="scripts/global/export.js"></script>
    <!-- models -->
    <script src="scripts/models/equipment.js"></script>
    <script src='scripts/models/skill.js'></script>
    <script src="scripts/models/movement.js"></script>
    <script src="scripts/models/physicalStatus.js"></script>
    <script src='scripts/models/character.js'></script>
    <!-- viewModels -->
    <script src="scripts/viewModels/widgets/base.js"></script>
    <script src="scripts/viewModels/widgets/text.js"></script>
    <script src="scripts/viewModels/widgets/border.js"></script>
    <script src="scripts/viewModels/widgets/grid.js"></script>
    <script src="scripts/viewModels/widgets/horizontalContainer.js"></script>
    <script src="scripts/viewModels/widgets/verticalContainer.js"></script>
    <script src='scripts/viewModels/character.js'></script>
    <script src="scripts/viewModels/title.js"></script>
    <script src="scripts/viewModels/uiASCII.js"></script>

</head>
<body>
    <div class="rightBorder" id="rightBorder">
        <div class="leftBorder" id="leftBorder">
            <header>
                <h1>Heavy Gear</h1>
                <h1 data-bind="click: debugme">Character Builder</h1>
                <h6 data-bind="text: versionNumber"></h6>
            </header>
            <div class="center">
                <div class="left imageholder">
                    <div class="descriptionsDiv left">
                        <img style="float:right" src = 'images/HG/skunkwerks.png' width="44" height="38" />
                        <div class ="left">
                            <label>Name</label>
                            <br/>
                            <input type="text" data-bind="value: characterName, valueUpdate:'afterkeydown'" />
                        </div>
                        <div class ="left">
                            <label>Profession</label>
                            <br/>
                            <input type="text" data-bind="value: characterProfession, valueUpdate:'afterkeydown'" />
                        </div>
                        <div class="buttons">                            
                            <a href="characterList.html"><img src='images/home.png' data-bind="tooltip: 'Character list'" /></a>
                            <img src='images/save.png' data-bind="tooltip: 'Save to local storage', click: saveToLocalStorage" />
                            <img src='images/sheet.png' data-bind="tooltip: 'Export to text file', click: exportToASCII" />
                        </div>
                        <div class="clear"></div>
                        <div class ="left">
                            <label>Rank</label>
                            <br/>
                            <input type="text" data-bind="value: characterRank, valueUpdate:'afterkeydown'" />
                        </div>
                        <div class ="left">
                            <label>Nationality</label>
                            <br/>
                            <input type="text" data-bind="value: characterNationality, valueUpdate:'afterkeydown'" />
                        </div>
                        <div class ="left">
                            <label>Unit</label>
                            <br/>                                
                            <input type="text" data-bind="value: characterUnit, valueUpdate:'afterkeydown'" />
                        </div>
                        <div class="clear"></div>
                        <div class ="left">
                            <label>Experience</label>
                            <br/>
                            <input type="text" data-bind="value: characterExperience, valueUpdate:'afterkeydown'" />
                        </div>
                        <div class ="left">
                            <label>Currency</label>
                            <br/>
                            <input type="text" data-bind="value: currency, valueUpdate:'afterkeydown'" />
                        </div>
                        <div class ="left">
                            <label>Currency On Hand</label>
                            <br/>
                            <input type="text" data-bind="value: currencyOnHand, valueUpdate:'afterkeydown'" />
                        </div>
                        <div class ="left">
                            <label>Emergency Dice</label>
                            <br/>
                            <input type="text" data-bind="value: emergencyDice, valueUpdate:'afterkeydown'" />
                        </div>                        
                    </div>  
                    <div class="clear"></div>
                    <div class="left">
                        <div class="attributesDiv left">                            
                            <div class ="left">
                                <label data-bind="tooltip: 'Agility'">AGI</label>
                                <br/>
                                <input class="attributeInput" type="text" data-bind="value: attributeAgility, valueUpdate:'afterkeydown'" />
                            </div>
                            <div class="clear"></div>
                            <div class ="left">
                                <label data-bind="tooltip: 'Appearance'">APP</label>
                                <br/>
                                <input class="attributeInput" type="text" data-bind="value: attributeAppearance, valueUpdate:'afterkeydown'" />
                            </div>                            
                            <div class="clear"></div>
                            <div class ="left">
                                <label data-bind="tooltip: 'Build'">BLD</label>
                                <br/>
                                <input class="attributeInput" type="text" data-bind="value: attributeBuild, valueUpdate:'afterkeydown'" />
                            </div>
                            <div class="clear"></div>
                            <div class ="left">
                                <label data-bind="tooltip: 'Creativity'">CRE</label>
                                <br/>
                                <input class="attributeInput" type="text" data-bind="value: attributeCreativity, valueUpdate:'afterkeydown'" />
                            </div>
                            <div class="clear"></div>
                            <div class ="left">
                                <label data-bind="tooltip: 'Fitness'">FIT</label>
                                <br/>
                                <input class="attributeInput" type="text" data-bind="value: attributeFitness, valueUpdate:'afterkeydown'" />
                            </div>
                            <div class="clear"></div>
                            <div class ="left">
                                <label data-bind="tooltip: 'Influence'">INF</label>
                                <br/>
                                <input class="attributeInput" type="text" data-bind="value: attributeInfluence, valueUpdate:'afterkeydown'" />
                            </div>
                            <div class="clear"></div>
                            <div class ="left">
                                <label data-bind="tooltip: 'Knowledge'">KNO</label>
                                <br/>
                                <input class="attributeInput" type="text" data-bind="value: attributeKnowledge, valueUpdate:'afterkeydown'" />
                            </div>
                            <div class="clear"></div>                            
                            <div class ="left">
                                <label data-bind="tooltip: 'Perception'">PER</label>
                                <br/>
                                <input class="attributeInput" type="text" data-bind="value: attributePerception, valueUpdate:'afterkeydown'" />
                            </div>
                            <div class="clear"></div>
                            <div class ="left">
                                <label data-bind="tooltip: 'Psyche'">PSY</label>
                                <br/>
                                <input class="attributeInput" type="text" data-bind="value: attributePsyche, valueUpdate:'afterkeydown'" />
                            </div>
                            <div class="clear"></div>
                            <div class ="left">
                                <label data-bind="tooltip: 'Willpower'">WIL</label>
                                <br/>
                                <input class="attributeInput" type="text" data-bind="value: attributeWillpower, valueUpdate:'afterkeydown'" />
                            </div>
                            <div class="clear"></div>

                            <span data-bind="tooltip: 'Character Points are the amount of points spent into your attribute scores.'">CPs:</span>&nbsp;<span data-bind="text: characterPoints"></span><br/>
                        </div>                            
                        <div class="clear"></div>
                    </div>
                    <div class="left">
                        <div class="left">
                            <div class="physicalStatusDiv left">
                                <h2>Physical Status</h2>
                                <table id="physicalStatusTable">
                                    <tr>
                                        <th>INJURY</th>
                                        <th>SCORE</th>
                                        <th>ARMOR</th>
                                        <th>PENALTY</th>
                                        <th>#</th>
                                    </tr>
                                    <tr>
                                        <th class="stringColumn">FLESH WOUND</th>
                                        <td><span data-bind="text: injuryThresholdFlesh"></span></td>
                                        <td><span data-bind="text: armorRating() + '/' + helmetRating()"></span></td>
                                        <th>-1</th>
                                        <td><input class="attributeInput" type="text" data-bind="value: injuryCountFlesh, valueUpdate:'afterkeydown'" /></td>
                                    </tr>
                                    <tr>
                                        <th class="stringColumn">DEEP WOUND</th>
                                        <td><span data-bind="text: injuryThresholdDeep"></span></td>
                                        <td><span data-bind="text: armorRating() + '/' + helmetRating()"></span></td>
                                        <th>-2</th>
                                        <td><input class="attributeInput" type="text" data-bind="value: injuryCountDeep, valueUpdate:'afterkeydown'" /></td>
                                    </tr>
                                    <tr>
                                        <th class="stringColumn">INSTANT DEATH</th>
                                        <td><span data-bind="text: injuryThresholdInstant"></span></td>
                                        <td><span data-bind="text: armorRating() + '/' + helmetRating()"></span></td>
                                        <th>DEAD</th>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <th class="stringColumn">SYSTEM SHOCK</th>
                                        <td><span data-bind="text: systemShockThreshold"></span></td>
                                        <td></td>
                                        <th>DEAD</th>
                                        <td><span data-bind="text: parseInt(injuryCountDeep()) * 2 + parseInt(injuryCountFlesh())"></span></td>
                                    </tr>
                                </table>
                            </div>
                            <div class="clear"></div>
                            <div class="secondaryTraitsDiv left">
                                <div class ="left">
                                    <label data-bind="tooltip: 'Strength'">STR</label>
                                    <br/>
                                    <span data-bind="text: secondaryTraitStrength"></span>
                                </div>
                                <div class="clear"></div>
                                <div class ="left">
                                    <label data-bind="tooltip: 'Strength'">HEA</label>
                                    <br/>
                                    <span data-bind="text: secondaryTraitHealth"></span>
                                </div>
                                <div class="clear"></div>
                                <div class ="left">
                                    <label data-bind="tooltip: 'Strength'">STA</label>
                                    <br/>
                                    <span data-bind="text: secondaryTraitStamina"></span>
                                </div>
                                <div class="clear"></div>
                                <div class ="left">
                                    <label data-bind="tooltip: 'Strength'">STR</label>
                                    <br/>
                                    <span data-bind="text: secondaryTraitStrength"></span>
                                </div>
                                <div class="clear"></div>
                                <div class ="left">
                                    <label data-bind="tooltip: 'Strength'">UD</label>
                                    <br/>
                                    <span data-bind="text: secondaryTraitUnarmedDamage"></span>
                                </div>
                                <div class="clear"></div>
                                <div class ="left">
                                    <label data-bind="tooltip: 'Strength'">AD</label>
                                    <br/>
                                    <span data-bind="text: secondaryTraitArmedDamage"></span>
                                </div>
                                <div class="clear"></div>
                            </div>                            
                        </div>
                        <div class="skillsDiv left">
                            <h2>Skills</h2>
                            SPs: <span data-bind="text: skillPoints"></span>
                            <table>
                                <tr>
                                    <th>
                                        <span data-bind="tooltip: 'This is the name of the skill you wish to add.'">NAME</span>
                                    </th>
                                    <th>
                                        <span data-bind="tooltip: 'A complex skill doubles the cost of each level.'">CPLX</span>
                                    </th>
                                    <th>
                                        <span data-bind="tooltip: 'The level represents how many dice you will be rolling when using this skill.'">LVL</span>
                                    </th>
                                    <th>
                                        <span data-bind="tooltip: 'This attribute directly coincides with the characters attributes. The value will affect whatever value is rolled when using the skill.'">ATTR</span>
                                    </th>
                                    <th>
                                        <span data-bind="tooltip: 'Add or remove a skill from your character.'">
                                            +/-
                                        </span>
                                    </th>
                                </tr>
                                <tr>
                                    <td>
                                        <input class="stringInput" id="inputSkillName" type="text" data-bind="value: inputSkillName" />
                                    </td>
                                    <td>
                                        <input id="inputComplex" type="checkbox" data-bind="checked: inputComplex" />
                                    </td>
                                    <td>
                                        <input class="numericInput" id="inputLevel" type="text" data-bind="value: inputLevel" />
                                    </td>
                                    <td>
                                        <select id="inputAttribute" data-bind="options: inputAttributes, value: inputAttribute"></select>
                                    </td>
                                    <td>
                                        <img src='images/plus.png' data-bind="click: insertSkill" />
                                    </td>
                                </tr>
                                <!-- ko foreach: skills -->
                                <tr>
                                    <td class="stringColumn">
                                        <span data-bind="text: name"></span>
                                    </td>
                                    <td>
                                        <span data-bind="text: isComplex ? 'Yes' : 'No'"></span>
                                    </td>
                                    <td>
                                        <span data-bind="text: level"></span>
                                        <img src='images/arrow_up.png' data-bind="click: $root.incrementSkill" />
                                        <img src='images/arrow_down.png' data-bind="click: $root.decrementSkill" />
                                    </td>
                                    <td>
                                        <span data-bind="text: $parent.attributeSelector($data.bonus) + '&nbsp;&nbsp;&nbsp;(' + $data.bonus.substring(0,3).toUpperCase() + ')'"></span>
                                    </td>
                                    <td>
                                        <img src='images/minus.png' data-bind="click: $root.removeSkill" />                                    
                                    </td>
                                </tr>
                                <!-- /ko -->
                            </table>
                        </div>
                        <div class="clear"></div>
                    </div>
                </div>
                <div class="left">
                    <div class="weaponsDiv left">
                        <h2>Weapons</h2>
                        <table>
                            <tr>
                                <th>
                                    NAME
                                </th>
                                <th>
                                    MASS (kg)
                                </th>
                                <th>
                                    ACC
                                </th>
                                <th>
                                    DAM
                                </th>
                                <th>
                                    RANGE
                                </th>
                                <th>
                                    AMMO
                                </th>
                                <th>
                                    ROF
                                </th>
                                <th>
                                    RADIUS
                                </th>
                                <th>
                                </th>
                            </tr>
                            <tr>
                                <td>
                                    <input class="stringInput" id="inputWeaponName" type="text" data-bind="value: inputWeaponName" />
                                </td>
                                <td>
                                    <input class="numericInput" id="inputWeaponMass" type="text" data-bind="value: inputWeaponMass" />
                                </td>
                                <td>
                                    <input class="numericInput" id="inputWeaponAccuracy" type="text" data-bind="value: inputWeaponAccuracy" />
                                </td>
                                <td>
                                    <input class="numericInput" id="inputWeaponDamage" type="text" data-bind="value: inputWeaponDamage" />
                                </td>
                                <td>
                                    <input class="numericInput" id="inputWeaponRange" type="text" data-bind="value: inputWeaponRange" />
                                </td>
                                <td>
                                    <input class="numericInput" id="inputWeaponAmmo" type="text" data-bind="value: inputWeaponAmmo" />
                                </td>
                                <td>
                                    <input class="numericInput" id="inputWeaponRateOfFire" type="text" data-bind="value: inputWeaponRateOfFire" />
                                </td>
                                <td>
                                    <input class="numericInput" id="inputWeaponRadius" type="text" data-bind="value: inputWeaponRadius" />
                                </td>
                                <td>
                                    <img src='images/plus.png' data-bind="click: insertWeapon" />
                                </td>
                            </tr>
                            <!-- ko foreach: weapons -->
                            <tr>
                                <td class="stringColumn">
                                    <span data-bind="text: name"></span>
                                </td>
                                <td>
                                    <span data-bind="text: mass"></span>
                                </td>
                                <td>
                                    <span data-bind="text: accuracy"></span>
                                </td>
                                <td>
                                    <span data-bind="text: damage"></span>
                                </td>
                                <td>
                                    <span data-bind="text: range + '/' + mediumRange + '/' + longRange + '/' + extremeRange"></span>
                                </td>
                                <td>
                                    <span data-bind="text: ammoMax"></span>
                                </td>
                                <td>
                                    <span data-bind="text: rateOfFire"></span>
                                </td>
                                <td>
                                    <span data-bind="text: radius"></span>
                                </td>
                                <td>
                                    <img src='images/minus.png' data-bind="click: $root.removeEquipment" />                                    
                                </td>
                            </tr>
                            <!-- /ko -->
                        </table>
                    </div>
                    <div class="clear"></div>
                    <div class="armorDiv left">
                        <h2>Armor</h2>
                        <table>
                            <tr>
                                <th>
                                    NAME
                                </th>
                                <th>
                                    MASS (kg)
                                </th>
                                <th>
                                    TYPE
                                </th>
                                <th>
                                    ARMOR
                                </th>
                                <th>
                                </th>
                            </tr>
                            <tr>
                                <td>
                                    <input class="stringInput" id="inputArmorName" type="text" data-bind="value: inputArmorName" />
                                </td>
                                <td>
                                    <input class="numericInput" id="inputArmorMass" type="text" data-bind="value: inputArmorMass" />
                                </td>
                                <td>
                                    <select id="inputArmorType" data-bind="options: ['Armor', 'Helmet'], value: inputArmorType"></select>
                                </td>
                                <td>
                                    <input class="numericInput" id="inputArmor" type="text" data-bind="value: inputArmor" />
                                </td>
                                <td>
                                    <img src='images/plus.png' data-bind="click: insertArmor" />
                                </td>
                            </tr>
                            <!-- ko foreach: armor -->
                            <tr>
                                <td class="stringColumn">
                                    <span data-bind="text: name"></span>
                                </td>
                                <td>
                                    <span data-bind="text: mass"></span>
                                </td>
                                <td>
                                    <span data-bind="text: type"></span>
                                </td>
                                <td>
                                    <span data-bind="text: armor"></span>
                                </td>
                                <td>
                                    <img src='images/minus.png' data-bind="click: $root.removeEquipment" />                                    
                                </td>
                            </tr>
                            <!-- /ko -->
                        </table>
                    </div>
                    <div class="clear"></div>
                                    <div class="equipmentDiv left">
                    <h2>Equipment</h2>
                    <table>
                        <tr>
                            <th>
                                NAME
                            </th>
                            <th>
                                MASS (kg)
                            </th>
                            <th>
                                #
                            </th>
                            <th>
                            </th>
                        </tr>
                        <tr>
                            <td>
                                <input class="stringInput" id="inputEquipmentName" type="text" data-bind="value: inputEquipmentName" />
                            </td>
                            <td>
                                <input class="numericInput" id="inputEquipmentMass" type="text" data-bind="value: inputEquipmentMass" />
                            </td>
                            <td>
                            </td>
                            <td>
                                <img src='images/plus.png' data-bind="click: insertEquipment" />
                            </td>
                        </tr>
                        <!-- ko foreach: equipment -->
                        <tr>
                            <td class="stringColumn">
                                <span data-bind="text: name"></span>
                            </td>
                            <td>
                                <span data-bind="text: mass"></span>
                            </td>
                            <td>
                                <span data-bind="text: quantity"></span>
                                <img src='images/arrow_up.png' data-bind="click: $root.increaseQuantity" />
                                <img src='images/arrow_down.png' data-bind="click: $root.decreaseQuantity" />
                            </td>
                            <td>
                                <img src='images/minus.png' data-bind="click: $root.removeEquipment" />
                            </td>
                        </tr>
                        <!-- /ko -->
                        <tr>
                            <td class="stringColumn">
                                <span data-bind="text: 'TOTAL'"></span>
                            </td>
                            <td>
                                <span data-bind="text: $root.equipment().sum(function(item){ return parseFloat(item.mass * item.quantity());})"></span>
                            </td>
                        </tr>
                    </table>
                </div>
                </div>
            </div>            
        </div>
    </div>

    <footer>        
        <a href='tests.html'><img style="margin: 5 5 5 5;" src='images/refresh.png' data-bind="tooltip: 'Test runner'" /></a>
    </footer>

    <script>
        $(function(){
            var character = new window.CharacterBuilder.Character();
            var urlParams = GetQueryParams(window.location.href);
            if(urlParams.loadFromUUID)
                character.loadFromLocalStorage(urlParams.loadFromUUID);
            $('#inputSkillName').devbridgeAutocomplete({
                lookup: character.skillsSuggestions(),
                onSelect: function (suggestion) { character.selectedSuggestion(suggestion.value); }
            });
            ko.applyBindings(character, $('body').get(0));
            Title.watchCharacterName(character.characterName);
            ko.applyBindings(Title, $('#title').get(0));
        });
    </script>
</body>
</html>